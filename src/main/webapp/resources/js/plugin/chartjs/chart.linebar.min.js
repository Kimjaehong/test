(function(){"use strict";var t=this,i=t.Chart,s=i.helpers,e={labelsFilter:function(){return!1},scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,bezierCurve:!0,bezierCurveTension:.4,pointDot:!0,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'};i.Type.extend({name:"LineBar",defaults:e,initialize:function(t){var e=this.options;this.barDatasets=[],this.lineDatasets=[],this.ScaleClass=i.Scale.extend({offsetGridLines:!0,calculateBarX:function(t,i,s){var o=this.calculateBaseWidth(),a=this.calculateX(s)-o/2,n=this.calculateBarWidth(t);return a+n*i+i*e.barDatasetSpacing+n/2},calculateBaseWidth:function(){return this.calculateX(1)-this.calculateX(0)-2*e.barValueSpacing},calculateBarWidth:function(t){var i=this.calculateBaseWidth()-(t-1)*e.barDatasetSpacing;return i/t}}),this.PointClass=i.Point.extend({strokeWidth:this.options.pointDotStrokeWidth,radius:this.options.pointDotRadius,display:this.options.pointDot,hitDetectionRadius:this.options.pointHitDetectionRadius,ctx:this.chart.ctx,inRange:function(t){return Math.pow(t-this.x,2)<Math.pow(this.radius+this.hitDetectionRadius,2)}}),this.datasets=[],this.options.showTooltips&&s.bindEvents(this,this.options.tooltipEvents,function(t){var i="mouseout"!==t.type?this.getDataAtEvent(t):[];this.eachBars(function(t){t.restore(["fillColor","strokeColor"])}),this.eachPoints(function(t){t.restore(["fillColor","strokeColor"])}),s.each(i,function(t){t.fillColor=t.highlightFill,t.strokeColor=t.highlightStroke}),this.showTooltip(i)}),this.BarClass=i.Rectangle.extend({strokeWidth:this.options.barStrokeWidth,showStroke:this.options.barShowStroke,ctx:this.chart.ctx}),s.each(t.datasets,function(i){var e={label:i.label||null,fillColor:i.fillColor,strokeColor:i.strokeColor,type:i.type,bars:[],pointColor:i.pointColor,pointStrokeColor:i.pointStrokeColor,points:[]};switch(this.datasets.push(e),i.type){case"line":this.lineDatasets.push(e),s.each(i.data,function(s,o){e.points.push(new this.PointClass({value:s,label:t.labels[o],datasetLabel:i.label,strokeColor:i.pointStrokeColor,fillColor:i.pointColor,highlightFill:i.pointHighlightFill||i.pointColor,highlightStroke:i.pointHighlightStroke||i.pointStrokeColor}))},this);break;default:this.barDatasets.push(e),s.each(i.data,function(s,o){e.bars.push(new this.BarClass({value:s,label:t.labels[o],datasetLabel:i.label,strokeColor:i.strokeColor,fillColor:i.fillColor,highlightFill:i.highlightFill||i.fillColor,highlightStroke:i.highlightStroke||i.strokeColor}))},this)}},this),this.buildScale(t.labels),s.each(this.lineDatasets,function(){this.eachPoints(function(t,i){s.extend(t,{x:this.scale.calculateX(i),y:this.scale.endPoint}),t.save()},this)},this),this.BarClass.prototype.base=this.scale.endPoint,this.eachBars(function(t,i,e){s.extend(t,{width:this.scale.calculateBarWidth(this.barDatasets.length),x:this.scale.calculateBarX(this.barDatasets.length,e,i),y:this.scale.endPoint}),t.save()},this),this.render()},update:function(){this.scale.update(),s.each(this.activeElements,function(t){t.restore(["fillColor","strokeColor"])}),this.eachBars(function(t){t.save()}),this.eachPoints(function(t){t.save()}),this.render()},eachPoints:function(t){s.each(this.lineDatasets,function(i){s.each(i.points,t,this)},this)},eachBars:function(t){s.each(this.barDatasets,function(i,e){s.each(i.bars,t,this,e)},this)},getDataAtEvent:function(t){return this.getPointsAtEvent(t).concat(this.getBarsAtEvent(t))},getPointsAtEvent:function(t){var i=[],e=s.getRelativePosition(t);return s.each(this.lineDatasets,function(t){s.each(t.points,function(t){t.inRange(e.x,e.y)&&i.push(t)})},this),i},getBarsAtEvent:function(t){for(var i,e=[],o=s.getRelativePosition(t),a=function(t){e.push(t.bars[i])},n=0;n<this.barDatasets.length;n++)for(i=0;i<this.barDatasets[n].bars.length;i++)if(this.barDatasets[n].bars[i].inRange(o.x,o.y))return s.each(this.barDatasets,a),e;return e},buildScale:function(t){var i=this,e=function(){var t=[];return i.eachBars(function(i){t.push(i.value)}),t},o={labelsFilter:this.options.labelsFilter,templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:t.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(t){var i=s.calculateScaleRange(e(),t,this.fontSize,this.beginAtZero,this.integersOnly);s.extend(this,i)},xLabels:t,font:s.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.barShowStroke?this.options.barStrokeWidth:0,showLabels:this.options.scaleShowLabels,display:this.options.showScale};this.options.scaleOverride&&s.extend(o,{calculateYRange:s.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}),this.scale=new this.ScaleClass(o)},addData:function(t,i){var e=0,o=0;s.each(t,function(t,s){switch(this.datasets[s].type){case"line":this.lineDatasets[e].points.push(new this.PointClass({value:t,label:i,x:this.scale.calculateX(this.scale.valuesCount+1),y:this.scale.endPoint,strokeColor:this.lineDatasets[e].pointStrokeColor,fillColor:this.lineDatasets[e].pointColor})),e++;break;default:this.barDatasets[o].bars.push(new this.BarClass({value:t,label:i,x:this.scale.calculateBarX(this.barDatasets.length,o,this.scale.valuesCount+1),y:this.scale.endPoint,width:this.scale.calculateBarWidth(this.barDatasets.length),base:this.scale.endPoint,strokeColor:this.barDatasets[o].strokeColor,fillColor:this.barDatasets[o].fillColor})),o++}},this),this.scale.addXLabel(i),this.update()},removeData:function(){this.scale.removeXLabel(),s.each(this.barDatasets,function(t){t.bars.shift()},this),s.each(this.lineDatasets,function(t){t.points.shift()},this),this.update()},reflow:function(){s.extend(this.BarClass.prototype,{y:this.scale.endPoint,base:this.scale.endPoint});var t=s.extend({height:this.chart.height,width:this.chart.width});this.scale.update(t)},draw:function(t){var i=t||1;this.clear();var e=this.chart.ctx,o=function(t){return null!==t.value},a=function(t,i,e){return s.findNextWhere(i,o,e)||t},n=function(t,i,e){return s.findPreviousWhere(i,o,e)||t};this.scale.draw(i),s.each(this.lineDatasets,function(t){var l=s.where(t.points,o);s.each(t.points,function(t,s){t.hasValue()&&t.transition({y:this.scale.calculateY(t.value),x:this.scale.calculateX(s)},i)},this),this.options.bezierCurve&&s.each(l,function(t,i){var e=i>0&&i<l.length-1?this.options.bezierCurveTension:0;t.controlPoints=s.splineCurve(n(t,l,i),t,a(t,l,i),e),t.controlPoints.outer.y>this.scale.endPoint?t.controlPoints.outer.y=this.scale.endPoint:t.controlPoints.outer.y<this.scale.startPoint&&(t.controlPoints.outer.y=this.scale.startPoint),t.controlPoints.inner.y>this.scale.endPoint?t.controlPoints.inner.y=this.scale.endPoint:t.controlPoints.inner.y<this.scale.startPoint&&(t.controlPoints.inner.y=this.scale.startPoint)},this),e.lineWidth=this.options.datasetStrokeWidth,e.strokeStyle=t.strokeColor,e.beginPath(),s.each(l,function(t,i){if(0===i)e.moveTo(t.x,t.y);else if(this.options.bezierCurve){var s=n(t,l,i);e.bezierCurveTo(s.controlPoints.outer.x,s.controlPoints.outer.y,t.controlPoints.inner.x,t.controlPoints.inner.y,t.x,t.y)}else e.lineTo(t.x,t.y)},this),e.stroke(),this.options.datasetFill&&l.length>0&&(e.lineTo(l[l.length-1].x,this.scale.endPoint),e.lineTo(l[0].x,this.scale.endPoint),e.fillStyle=t.fillColor,e.closePath(),e.fill()),s.each(l,function(t){t.draw()})},this),s.each(this.barDatasets,function(t,e){s.each(t.bars,function(t,s){t.hasValue()&&(t.base=this.scale.endPoint,t.transition({x:this.scale.calculateBarX(this.barDatasets.length,e,s),y:this.scale.calculateY(t.value),width:this.scale.calculateBarWidth(this.barDatasets.length)},i).draw())},this)},this)},showTooltip:function(t,e){"undefined"==typeof this.activeElements&&(this.activeElements=[]);var o=function(t){var i=!1;return t.length!==this.activeElements.length?i=!0:(s.each(t,function(t,s){t!==this.activeElements[s]&&(i=!0)},this),i)}.call(this,t);if(o||e){if(this.activeElements=t,this.draw(),t.length>0)if(this.datasets&&this.datasets.length>1){for(var a,n,l=this.lineDatasets.length-1;l>=0&&(a=this.datasets[l].points,n=s.indexOf(a,t[0]),-1===n);l--);if(-1===n)for(l=this.barDatasets.length-1;l>=0&&(a=this.datasets[l].bars,n=s.indexOf(a,t[0]),-1===n);l--);var h=[],r=[],c=function(){var t,i,e,o,a,l=[],c=[],u=[];return s.each(this.lineDatasets,function(i){t=i.points,t[n]&&t[n].hasValue()&&l.push(t[n])}),s.each(this.barDatasets,function(i){t=i.bars,t[n]&&t[n].hasValue()&&l.push(t[n])}),s.each(l,function(t){c.push(t.x),u.push(t.y),h.push(s.template(this.options.multiTooltipTemplate,t)),r.push({fill:t._saved.fillColor||t.fillColor,stroke:t._saved.strokeColor||t.strokeColor})},this),a=s.min(u),e=s.max(u),o=s.min(c),i=s.max(c),{x:o>this.chart.width/2?o:i,y:(a+e)/2}}.call(this,n);new i.MultiTooltip({x:c.x,y:c.y,xPadding:this.options.tooltipXPadding,yPadding:this.options.tooltipYPadding,xOffset:this.options.tooltipXOffset,fillColor:this.options.tooltipFillColor,textColor:this.options.tooltipFontColor,fontFamily:this.options.tooltipFontFamily,fontStyle:this.options.tooltipFontStyle,fontSize:this.options.tooltipFontSize,titleTextColor:this.options.tooltipTitleFontColor,titleFontFamily:this.options.tooltipTitleFontFamily,titleFontStyle:this.options.tooltipTitleFontStyle,titleFontSize:this.options.tooltipTitleFontSize,cornerRadius:this.options.tooltipCornerRadius,labels:h,legendColors:r,legendColorBackground:this.options.multiTooltipKeyBackground,title:t[0].label,chart:this.chart,ctx:this.chart.ctx}).draw()}else each(t,function(t){var s=t.tooltipPosition();new i.Tooltip({x:Math.round(s.x),y:Math.round(s.y),xPadding:this.options.tooltipXPadding,yPadding:this.options.tooltipYPadding,fillColor:this.options.tooltipFillColor,textColor:this.options.tooltipFontColor,fontFamily:this.options.tooltipFontFamily,fontStyle:this.options.tooltipFontStyle,fontSize:this.options.tooltipFontSize,caretHeight:this.options.tooltipCaretSize,cornerRadius:this.options.tooltipCornerRadius,text:template(this.options.tooltipTemplate,t),chart:this.chart}).draw()},this);return this}}})}).call(this);